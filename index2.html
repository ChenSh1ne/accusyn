<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Example genome</title>
  <script type="text/javascript" src="circos.js"></script>
  <script type="text/javascript" src="d3.js"></script>
  <script type="text/javascript" src="d3-queue.js"></script>

  <script type="text/javascript" src="lodash.js"></script>
  <style type="text/css">
    /* No style rules here yet */
  </style>
</head>

<body>
  <p>
    <label for="nAngle" style="display: inline-block; width: 240px; text-align: right">
     rotate = <span id="nAngle-value">…</span>
  </label>
    <input type="range" min="0" max="360" id="nAngle">
  </p>
  <script type="text/javascript">
    var width = 800;
    var height = 800;

    var svg = d3.select("body")
      .append("div")
      .attr('id', 'chart');

    var myCircos = new Circos({
      container: '#chart',
      width: width,
      height: height
    });

    var data = [{
        len: 100,
        color: "#8dd3c7",
        label: "chr1",
        id: "chr1"
      },
      {
        len: 28,
        color: "#ffffb3",
        label: "chr2",
        id: "chr2"
      },
      {
        len: 31,
        color: "#bebada",
        label: "chr3",
        id: "chr3"
      },
      {
        len: 30,
        color: "#fb8072",
        label: "chr4",
        id: "chr4"
      },
      {
        len: 31,
        color: "#80b1d3",
        label: "chr5",
        id: "chr5"
      },
      {
        len: 30,
        color: "#fdb462",
        label: "chr6",
        id: "chr6"
      },
      {
        len: 31,
        color: "#b3de69",
        label: "chr7",
        id: "chr7"
      }
    ];

    var configuration = {
      innerRadius: 250,
      outerRadius: 300,
      cornerRadius: 10,
      gap: 0.04, // in radian
      labels: {
        display: true,
        position: 'center',
        size: '14px',
        color: '#000000',
        radialOffset: 20,
      },
      ticks: {
        display: true,
        color: 'grey',
        spacing: 1,
        labels: true,
        labelSpacing: 10,
        labelSuffix: '',
        labelDenominator: 1,
        labelDisplay0: true,
        labelSize: '10px',
        labelColor: '#000000',
        labelFont: 'default',
        majorSpacing: 10,
        size: {
          minor: 3,
          major: 7,
        }
      },
      events: {
        'click': function(d, i, nodes, event) {
          d3.select(nodes[i]).attr("opacity", 0.5);

          var trackContainers = myCircos.svg.selectAll('.all > g');

          // console.log('CONTAINERS: ', trackContainers);

          /*myCircos.svg.selectAll('tile')
            .data((d) => {
              console.log(d);
            })
            .enter().append('path')
            .attr('class', 'tile')
            .attr('d', function (d) {
                console.log('D here: ', d);
            })*/
          //d.len = 200;
          console.log('clicked on layout block', d, i, nodes[i], event);
        }
      }
    };

    myCircos.layout(data, configuration);

    var dataChords = [{
        source: {
          id: 'chr1',
          start: 1,
          end: 12
        },
        target: {
          id: 'chr6',
          start: 18,
          end: 20
        }
      },
      {
        source: {
          id: 'chr2',
          start: 20,
          end: 28
        },
        target: {
          id: 'chr7',
          start: 1,
          end: 13
        }
      },
      {
        source: {
          id: 'chr1',
          start: 20,
          end: 28,
          value: 'blue'
        },
        target: {
          id: 'chr2',
          start: 1,
          end: 13
        }
      },
      {
        source: {
          id: 'chr1',
          start: 70,
          end: 72,
          value: 'purple'
        },
        target: {
          id: 'chr4',
          start: 1,
          end: 13
        }
      },
      {
        source: {
          id: 'chr5',
          start: 20,
          end: 22
        },
        target: {
          id: 'chr1',
          start: 51,
          end: 53
        }
      }
    ];

    myCircos.chords('l1', dataChords, {
      radius: function(d) {
        return null;
      },
      logScale: false,
      opacity: 0.7,
      color: function(d) {
        if (d.source.value) {
          return d.source.value;
        } else return '#ff5722';
      },
      tooltipContent: function(d) {
        return '<h3>' + d.source.id + ' ➤ ' + d.target.id + ': ' + d.value + '</h3><i>(CTRL+C to copy to clipboard)</i>'
      },
      events: {
        'mouseover.demo': function(d, i, nodes, event) {
          console.log(d, i, nodes, event.pageX)
        }
      }
    });

    d3.select("#nAngle").on("input", function() {
      update(+this.value);
    });

    // Initial starting angle of the text
    update(0);

    // update the element
    function update(nAngle) {

      // adjust the text on the range slider
      d3.select("#nAngle-value").text(nAngle + String.fromCharCode(176));
      d3.select("#nAngle").property("value", nAngle);

      // rotate the text
      svg.select(".all")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ") rotate(" + -nAngle + ")");
    }

    myCircos.render();
  </script>
</body>

</html>
